/*! CoursePress - v2.1.4
 * https://premium.wpmudev.org/project/coursepress-pro/
 * Copyright (c) 2017; * Licensed GPLv2+ */
var CoursePress=CoursePress||{};!function(a){CoursePress.Models.Course=CoursePress.Models.Course||Backbone.Model.extend({url:_coursepress._ajax_url+"?action=update_course",parse:function(a){!0===a.success?(this.set("response_data",a.data),this.trigger("coursepress:"+a.data.action+"_success",a.data)):(this.set("response_data",{}),this.trigger("coursepress:"+a.data.action+"_error",a.data)),CoursePress.Course.set("action","")},defaults:{}}),CoursePress.Course=new CoursePress.Models.Course,a(document).ready(function(a){a('[name*="publish-course-toggle"]').on("change",function(b,c){var d=a(this).attr("data-nonce"),e="off"===c?"draft":"publish",f=parseInt(a(this).attr("id").replace("publish-course-toggle-",""));CoursePress.Course.set("action","toggle_course_status");var g={nonce:d,status:e,state:c,course_id:f};CoursePress.Course.set("data",g),CoursePress.Course.save()}),CoursePress.Course.on("coursepress:toggle_course_status_success",function(b){a('[name="publish-course-toggle-'+b.course_id+'"]').attr("data-nonce",b.nonce)}),CoursePress.Course.on("coursepress:toggle_course_status_error",function(b){var c=a('[name="publish-course-toggle-'+b.course_id+'"]');a(c).hasClass("on")?a(c).removeClass("on").addClass("off"):a(c).hasClass("off")&&a(c).removeClass("off").addClass("on")}),a(".bulkactions .button.action").on("click",function(){var b=a(".nonce-holder").attr("data-nonce"),c=[],d=[];a(this).parents("form").first();if(a.each(a('[name="post[]"]'),function(b,e){a(e).is(":checked")&&(c.push(a(e).val()),d.push(a(".post_title strong",a(e).closest("tr")).html()))}),0===c.length)return!1;var e=a(this).siblings("select").val();e="-1"===e?"":e;var f=!0;if("delete"===e){f=window.confirm(_coursepress.courselist_bulk_delete);var g,h="coursepress-courses-delete-one",i={names:"",size:c.length};1==c.length?i.names=d.join():(h="coursepress-courses-delete-more",i.names="<ul><li>"+d.join("</li><li>")+"</ul>"),g=wp.template(h),a("#wpbody-content h1").after(g(i))}if("export"===e){if(0===c.length)return alert(_coursepress.courselist_export),!1;var j="&";a.each(c,function(a,b){j+="coursepress[courses]["+b+"]="+b+"&"});var k=a(".export-nonce-holder").attr("data-nonce");return window.location="./admin.php?page=coursepress_export"+j+"coursepress_export="+k,!1}if(e.length>0&&f){CoursePress.Course.set("action","bulk_actions");var i={nonce:b,the_action:e,courses:c};CoursePress.Course.set("data",i),CoursePress.Course.save()}}),CoursePress.Course.on("coursepress:bulk_actions_success",function(b){a(".nonce-holder").attr("data-nonce",b.nonce),window.location.reload()}),CoursePress.Course.on("coursepress:bulk_actions_error",function(){window.location.reload()}),a(".delete-course-link").on("click",function(b){b.stopImmediatePropagation(),b.preventDefault();var c=a(this),d=c.parents("tr").first();if(window.confirm(_coursepress.courselist_delete_course)){e={names:a(".post_title strong",d).html()},template=wp.template("coursepress-courses-delete-one"),a("#wpbody-content h1").after(template(e)),CoursePress.Course.set("action","delete_course");var e={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")};CoursePress.Course.set("data",e),CoursePress.Course.save(),CoursePress.Course.off("coursepress:delete_course_success"),CoursePress.Course.on("coursepress:delete_course_success",function(){window.location.reload()}),CoursePress.Course.on("coursepress:delete_course_error",function(){alert(_coursepress.server_error)})}}),a(".duplicate-course-link").on("click",function(b){var c;b.stopImmediatePropagation(),b.preventDefault();var d=a(this),e=d.parents("tr").first();window.confirm(_coursepress.courselist_duplicate_course)&&(c={names:a(".post_title strong",e).html()},template=wp.template("coursepress-courses-duplicate"),a("#wpbody-content h1").after(template(c)),CoursePress.Course.set("action","duplicate_course"),c={nonce:a(this).attr("data-nonce"),course_id:a(this).attr("data-id")},e.addClass("duplicating"),CoursePress.Course.set("data",c),CoursePress.Course.save(),CoursePress.Course.off("coursepress:duplicate_course_success"),CoursePress.Course.on("coursepress:duplicate_course_success",function(){window.location.reload()}))}),a(".coursepress-ui-toggle-switch").coursepress_ui_toggle()})}(jQuery);